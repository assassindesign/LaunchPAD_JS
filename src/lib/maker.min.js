var velocity,select,songs,LEDList,bg,bg2,canvas,projectName,timer,stage,st,autoE,keyE,ledE,oIdx,oDesc,sInfo,zip,choosedkey,url="http://127.0.0.1:9000",mobile=!1,IE=!1,opacity=",1)",keyColor=[],pressedKey=[],coloredKey=[],keyCount=[],counter=[],baseColor="#FFFFFF",strokeColor="rgba(255,255,255,0.65)",sound=[],audio=[],autoData=[],cirs=[],rects=[],rects2=[],velrects=[],veldrects=[],anim=[],drect=[],drect2=[],dcir=[],nowPage=0,chain=6,keyX=8,keyY=8,autoP=!1,keyTest=[],vt=[],oSelector=0,cnode=[],cspan=[],cspace=[],creset=[],sList=[],lstring=[],ablob=[],dirs=[],choosedcolor=0,pageKeyColor=[],keyLEDList=[],upKeyList=[];function cnv2Resize(){canvas.width=19*window.innerWidth/20,canvas.height=19*window.innerHeight/40,initBtnEL(),render()}function initBtnEL(){mobile||(canvas.removeEventListener("click",Clicked,!1),canvas.addEventListener("click",Clicked,!1))}function Clicked(e){collides(e.offsetX,e.offsetY),collides2(e.offsetX,e.offsetY),collides3(e.offsetX,e.offsetY),collides4(e.offsetX,e.offsetY)}function collides(e,t){for(var o=!1,n=0,s=rects.length;n<s;n++){var a=rects[n].x,r=rects[n].x+rects[n].w,c=rects[n].y,i=rects[n].y+rects[n].h;if(r>=e&&a<=e&&i>=t&&c<=t)if(o=rects[n],event.ctrlKey)myFunction(nowPage,n),choosedkey=-1;else{initz(),choosedkey=n;var l="Page:"+(nowPage+1)+" Button:"+parseInt(n/8+1)+","+(n%8+1)+"-"+counter[nowPage][n];keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]]||(keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]]=[]),keyTest[nowPage][n][counter[nowPage][n]]&&(ledE=setOptList(ledE,keyTest[nowPage][n][counter[nowPage][n]])),keyTest[nowPage][n].length>0&&keyLED1(nowPage,n,counter[nowPage][n],0),sound[nowPage][n][counter[nowPage][n]]&&(playAudio(nowPage,n),l=l.concat(" Duration:"+sound[nowPage][n][counter[nowPage][n]].duration)),document.getElementById("choosedKeyStat").innerText=l}}return o}function collides2(e,t){for(var o=!1,n=0,s=cirs.length;n<s;n++){var a=cirs[n].x,r=cirs[n].x+cirs[n].w,c=cirs[n].y,i=cirs[n].y+cirs[n].h;r>=e&&a<=e&&i>=t&&c<=t&&(o=cirs[n],nowPage=n,render())}return o}function collides3(e,t){for(var o=!1,n=0,s=rects2.length;n<s;n++){var a=rects2[n].x,r=rects2[n].x+rects2[n].w,c=rects2[n].y,i=rects2[n].y+rects2[n].h;if(r>=e&&a<=e&&i>=t&&c<=t)if(o=rects2[n],event.ctrlKey){d="off "+parseInt(n/8+1)+" "+(n%8+1);pageKeyColor[nowPage][n]=baseColor,(l=keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]]).push(d),ledE=setOptList(ledE,l)}else{pageKeyColor[nowPage][n]=keyColor[choosedcolor];var l,d="on "+parseInt(n/8+1)+" "+(n%8+1)+" a "+choosedcolor;(l=keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]]).push(d),ledE=setOptList(ledE,l)}}return o}function collides4(e,t){for(var o=!1,n=0,s=velrects.length;n<s;n++){var a=velrects[n].x,r=velrects[n].x+velrects[n].w,c=velrects[n].y,i=velrects[n].y+velrects[n].h;r>=e&&a<=e&&i>=t&&c<=t&&(o=velrects[n],choosedcolor=n)}return o}function myFunction(e,t){for(var o=0;o<cspace.length;o++)for(var n=0;n<cspace[o].length;n++)"popuptext show"==cspace[o][n].className.toLowerCase()?cspace[o][n].classList.toggle("show"):e==o&&t==n&&cspace[e][t].classList.toggle("show")}function resetFile(){document.getElementById("zipUp").files.length=0,selinit(),arrinit(),nowPage=0,choosedkey=-1,choosedcolor=0,LoadingStatus()}function render(){var e=canvas.width>canvas.height?canvas.height:canvas.width,t=e/(keyX*keyY);if(canvas&&stage&&canvas.width>=3.74*canvas.height){stage.removeChild(bg),(bg=new createjs.Shape).graphics.beginFill("#444444").drawRoundRect(0,0,(canvas.width-t)/3,canvas.height-t,t/2),bg.graphics.beginFill("#444444").drawRoundRect((canvas.width-t+6)/3,0,canvas.width-t,canvas.height-t,t/2),stage.addChild(bg);for(var o=0;o<keyX*keyY;o++)rects[o]={x:canvas.width/6-keyX/2*e/(keyX+1)+e*(o%keyX)/(keyX+2),y:canvas.height/2-keyY/2*e/(keyY+2)+e*parseInt(o/keyY)/(keyY+2),w:e/(keyX+3),h:e/(keyY+3)},rects2[o]={x:canvas.width/3+keyX/8*e/(keyX+1)+e*(o%keyX)/(keyX+2),y:canvas.height/2-keyY/2*e/(keyY+2)+e*parseInt(o/keyY)/(keyY+2),w:e/(keyX+3),h:e/(keyY+3)},stage.removeChild(drect[o]),stage.removeChild(drect2[o]),drect[o]=new createjs.Shape,drect2[o]=new createjs.Shape,pressedKey[o]>0?(drect[o].graphics.setStrokeStyle(t/2,"round","round",t).beginStroke(coloredKey[o]).beginFill(baseColor).drawRect(rects[o].x+t/3,rects[o].y+t/3,rects[o].w-2*t/3,rects[o].h-2*t/3),IE||(drect[o].shadow=new createjs.Shadow(coloredKey[o],0,0,2*t))):drect[o].graphics.setStrokeStyle(4*t/5,"round","round",t).beginStroke(strokeColor).beginFill(baseColor).drawRect(rects[o].x+t/2,rects[o].y+t/2,rects[o].w-t,rects[o].h-t),o==choosedkey?drect2[o].graphics.setStrokeStyle(t/2,"round","round",t).beginStroke(pageKeyColor[nowPage][o]).beginFill(keyColor[120]).drawRect(rects2[o].x+t/2,rects2[o].y+t/2,rects2[o].w-t,rects2[o].h-t):drect2[o].graphics.setStrokeStyle(t/2,"round","round",t).beginStroke(pageKeyColor[nowPage][o]).beginFill(baseColor).drawRect(rects2[o].x+t/2,rects2[o].y+t/2,rects2[o].w-t,rects2[o].h-t),stage.addChild(drect[o]),stage.addChild(drect2[o]);for(o=0;o<keyColor.length;o++)velrects[o]={x:canvas.width/3+8.8*e/9+e*(o%18)/12,y:canvas.height/2-4*e/10+e*parseInt(o/18)/12,w:e/12,h:e/12},stage.removeChild(veldrects[o]),stage.removeChild(vt[o]),vt[o]=new createjs.Text(o,e/32+"px Arial","#FF7700"),vt[o].x=velrects[o].x+e/64,vt[o].y=velrects[o].y+e/64,veldrects[o]=new createjs.Shape,veldrects[o].graphics.beginFill(keyColor[o]).drawRect(velrects[o].x+e/128,velrects[o].y+e/128,velrects[o].w-e/64,velrects[o].h-e/64),stage.addChild(veldrects[o]),stage.addChild(vt[o]);for(o=0;o<chain;o++)cirs[o]={x:rects[(o+1)*keyX-1].x+rects[0].w+t/2,y:rects[(o+1)*keyX-1].y,w:rects[(o+1)*keyX-1].w,h:rects[(o+1)*keyX-1].h},stage.removeChild(dcir[o]),dcir[o]=new createjs.Shape,dcir[o].graphics.setStrokeStyle(t/2),nowPage==o?(dcir[o].graphics.beginStroke("rgba(50,200,200,0.65)"),dcir[o].shadow=new createjs.Shadow("rgba(50,200,200,0.65)",0,0,2*t)):dcir[o].graphics.beginStroke(strokeColor),dcir[o].graphics.beginFill(baseColor).drawCircle(cirs[o].x+rects[0].w/2,cirs[o].y+rects[0].h/2,(cirs[o].w-t/2)/2),stage.addChild(dcir[o]);stage.update()}}function animate(){for(var e=(canvas.width>canvas.height?canvas.height:canvas.width)/(keyX*keyY),t=0;t<rects.length;t++)stage.removeChild(anim[t]),pressedKey[t]>0&&(anim[t]=new createjs.Shape,anim[t].graphics.setStrokeStyle(e/2,"round","round",e).beginStroke(coloredKey[t]).beginFill("transparent").drawRect(rects[t].x+e/3,rects[t].y+e/3,rects[t].w-2*e/3,rects[t].h-2*e/3),anim[t].shadow=new createjs.Shadow(coloredKey[t],0,0,2*e),stage.addChild(anim[t]));stage.update()}function animatecanv(e){var t=(canvas.width>canvas.height?canvas.height:canvas.width)/(keyX*keyY);e<rects.length&&(ctx.clearRect(rects[e].x+t/2,rects[e].y+t/2,rects[e].w-t,rects[e].h-t),ctx.fillStyle="#444444",ctx.lineJoin="round",ctx.lineWidth=t/(.15*keyY),ctx.fillRect(rects[e].x,rects[e].y,rects[e].w,rects[e].h),ctx.strokeStyle=strokeColor,ctx.fillStyle=baseColor,ctx.strokeRect(rects[e].x+t/2,rects[e].y+t/2,rects[e].w-t,rects[e].h-t),ctx.fillRect(rects[e].x+t/2,rects[e].y+t/2,rects[e].w-t,rects[e].h-t),pressedKey[e]>0&&(ctx.lineJoin="round",ctx.lineWidth=t/(.25*keyY),ctx.strokeStyle=coloredKey[e],ctx.strokeRect(rects[e].x+t/3,rects[e].y+t/3,rects[e].w-2*t/3,rects[e].h-2*t/3)))}function playAudio(e,t){sound[e][t][counter[e][t]]&&(sound[e][t][counter[e][t]].currentTime=0,sound[e][t][counter[e][t]].play(),counter[e][t]=(counter[e][t]+1)%keyCount[e][t])}function LoadingStatus(){document.getElementById("Info").innerTex="Info:Loading",document.getElementById("KeySound").innerText="KeySound:Loading",document.getElementById("LEDList").innerText="LEDList:Loading",document.getElementById("AutoData").innerText="AutoData:Loading"}function setOptList(e,t){e.options.length=0;for(var o=0;o<t.length;o++){var n=document.createElement("option");n.text=t[o],e.add(n,o)}return e}function sc(e){switch(e){case 1:oSelector=1,optSet(autoE,"AutoData");break;case 2:oSelector=2,optSet(keyE,"KeyData");break;case 3:oSelector=3,optSet(ledE,"LEDData")}}function scSet(){switch(oIdx=document.getElementById("oIdx").value,oSelector){case 1:autoData[oIdx]=document.getElementById("oDesc").value,autoE=setOptList(autoE,autoData);break;case 2:sList[oIdx]=document.getElementById("oDesc").value,keyE=setOptList(keyE,sList);break;case 3:keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]][oIdx]=document.getElementById("oDesc").value,ledE=setOptList(ledE,keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]])}}function scInsertA(){switch(oIdx=document.getElementById("oIdx").value,oSelector){case 1:autoData.splice(oIdx,0,document.getElementById("oDesc").value),autoE=setOptList(autoE,autoData);break;case 2:sList.splice(oIdx,0,document.getElementById("oDesc").value),keyE=setOptList(keyE,sList);break;case 3:keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]].splice(oIdx,0,document.getElementById("oDesc").value),ledE=setOptList(ledE,keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]])}}function scInsertB(){switch(oIdx=document.getElementById("oIdx").value,oSelector){case 1:autoData.splice(oIdx+1,0,document.getElementById("oDesc").value),autoE=setOptList(autoE,autoData);break;case 2:sList.splice(oIdx+1,0,document.getElementById("oDesc").value),keyE=setOptList(keyE,sList);break;case 3:keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]].splice(oIdx+1,0,document.getElementById("oDesc").value),ledE=setOptList(ledE,keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]])}}function scDelete(){switch(oSelector){case 1:autuData=listDel(autoE,autoData),autoE=setOptList(autoE,autoData);break;case 2:sList=listDel(keyE,sList),keyE=setOptList(keyE,sList);break;case 3:keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]]=listDel(ledE,keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]]),ledE=setOptList(ledE,keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]])}}function scDur(){switch(oSelector){case 1:autoData.push("d "+document.getElementById("sDur").value),autoE=setOptList(autoE,autoData);break;case 3:keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]].push("d "+document.getElementById("sDur").value),ledE=setOptList(ledE,keyTest[nowPage][choosedkey][counter[nowPage][choosedkey]])}}function listDel(e,t){for(var o=e.options.length;o>0;)o--,e.options[o].selected&&t.splice(o,1);return t}function optSet(e,t){document.getElementById("eName").innerText=t;for(var o=0;o<e.options.length;o++)e.options[o].selected&&(document.getElementById("oIdx").value=o,document.getElementById("oDesc").value=e.options[o].innerText)}function setInfo(e){sInfo=e,console.log(sInfo);for(var t=0;t<e.length;t++){var o=e[t].split("=");"chain"==o[0]&&(chain=parseInt(o[1])),"buttonX"==o[0]&&(keyX=parseInt(o[1])),"buttonY"==o[0]&&(keyY=parseInt(o[1]))}arrinit(),stage.removeAllChildren(),stage.clear(),render(),setUpForm(),document.getElementById("Info").innerText="Info:Loaded"}function setUpForm(){for(var e=document.getElementById("popSpace");e.firstChild&&e.hasChildNodes;)e.removeChild(e.firstChild);cnode.length=0,cspan.length=0,cspace.length=0,creset.length=0;for(var t=0;t<chain;t++){cnode[t]=[],cspan[t]=[],cspace[t]=[],creset[t]=[];for(var o=0;o<keyX*keyY;o++)cspace[t][o]=document.createElement("form"),cspace[t][o].setAttribute("class","popuptext"),cspan[t][o]=document.createElement("span"),cspan[t][o].innerText="Page:"+(t+1)+"/Button:"+(o+1),cnode[t][o]=document.createElement("input"),cnode[t][o].setAttribute("type","file"),cnode[t][o].setAttribute("id","myPopup_"+t+"_"+o),cnode[t][o].setAttribute("accept","audio/*"),cnode[t][o].setAttribute("multiple",""),cnode[t][o].setAttribute("onchange","fileLoader("+t+","+o+")"),creset[t][o]=document.createElement("input"),creset[t][o].setAttribute("type","reset"),creset[t][o].setAttribute("onclick","formReset("+t+","+o+")"),cspace[t][o].appendChild(cspan[t][o]),cspace[t][o].appendChild(cnode[t][o]),cspace[t][o].appendChild(creset[t][o]),e.appendChild(cspace[t][o])}}function formReset(e,t){setTimeout(function(){fileLoader(e,t)},50)}function fileLoader(e,t){cnode[e][t].files.length=0,sound[e][t].length=0,keyCount[e][t]=0,counter[e][t]=0;var o=cnode[e][t].files;upKeyList[e][t].length=0;var n=new FileReader;!function s(a){if(a>=o.length){keyE.options.length=0,sList.length=0;for(var r=0;r<chain;r++)for(var c=0;c<keyX*keyY;c++)upKeyList[r][c].length>0&&(sList=sList.concat(upKeyList[r][c]));keyE=setOptList(keyE,sList)}else{var i=o[a],l=e+1+" "+(parseInt(t/8)+1)+" "+(t%8+1)+" "+i.name;upKeyList[e][t].push(l),n.onload=function(o){audio[e][t][keyCount[e][t]]=i.name,sound[e][t][keyCount[e][t]]=new Audio,sound[e][t][keyCount[e][t]].src=o.target.result,keyCount[e][t]++,s(a+1)},n.readAsDataURL(i)}}(0)}function alz(){var e=[];e[0]=[],e[1]=[],lstring[0].length=0,lstring[1].length=0;for(var t=0;t<chain;t++)for(var o=0;o<keyX*keyY;o++)for(var n=0;n<keyCount[t][o];n++)keyTest[t][o][n]&&(lstring[0].push(t+1+" "+parseInt(o/8+1)+" "+(o%8+1)+" 1 "+(n+1)),lstring[1].push(keyTest[t][o][n].join("")));for(t=0;t<lstring[0].length;t++)zip.folder("keyLED").file(lstring[0][t],lstring[1][t])}function pj2zip(){alz();for(var e="",t="",o="",n=0;n<sInfo.length;n++)o=o.concat(sInfo[n]+"\n");for(n=0;n<autoData.length;n++)e=e.concat(autoData[n]+"\n");for(n=0;n<sList.length;n++)t=t.concat(sList[n]+"\n");zip.file("info",o),zip.file("autoPlay",e),zip.file("keySound",t),zip.generateAsync({type:"base64"}).then(function(e){location.href="data:application/zip;base64,"+e})}function setKey(e){for(var t=0;t<e.length;t++){var o=e[t].split(" ");if(4==o.length){var n=parseInt(o[0])-1,s=(parseInt(o[1])-1)*keyY+(parseInt(o[2])-1);sound[n][s].push(new Audio("Server/"+projectName+"/sounds/"+o[3])),audio[n][s][keyCount[n][s]]=o[3],keyCount[n][s]++}}document.getElementById("KeySound").innerText="KeySound:Loaded"}function setLED(e){for(var t=0;t<e.length;t++)!function(t){var o=e[t].split(" ");getData(projectName+"/keyLED/"+e[t],function(e){var t=parseInt(o[0])-1,n=(parseInt(o[1])-1)*keyX+(parseInt(o[2])-1);keyTest[t][n].push(e.msg);var s=keyTest[t][n].length-1;for(ir=0;ir<parseInt(o[3])-1;ir++)keyTest[t][n][s]=keyTest[t][n][s].concat(e.msg)})}(t);document.getElementById("LEDList").innerText="LEDList:Loaded"}function handleFile(e){e.name,new Date;JSZip.loadAsync(e).then(function(e){new Date;e.forEach(function(e,t){"info"==t.name.toLowerCase()?t.async("string").then(function(e){setInfo(e.split("\n"))}):"autoplay"==t.name.toLowerCase()?t.async("string").then(function(e){autoData.length=0,autoData=e.split("\n"),autoE=setOptList(autoE,autoData),document.getElementById("AutoData").innerText="AutoData:Loaded"}):"keysound"==t.name.toLowerCase()&&t.async("string").then(function(e){sList=e.split("\n"),keyE=setOptList(keyE,sList);for(var t=0;t<sList.length;t++)if((str=sList[t].split(" ")).length>=4){var o=sList[t];upKeyList[parseInt(str[0])-1][8*(parseInt(str[1])-1)+(parseInt(str[2])-1)]=o}}),1==t.dir&&dirs.push(e.replace(/\//gi,""))});for(var t=0;t<dirs.length;t++)"sounds"==dirs[t].toLowerCase()?e.folder(dirs[t]).forEach(function(t,o){e.file(o.name).async("blob").then(function(e){ablob[0].push(t),ablob[1].push(URL.createObjectURL(e))})}):"keyled"==dirs[t].toLowerCase()&&e.folder(dirs[t]).forEach(function(t,o){e.file(o.name).async("string").then(function(e){1==t.split(".").length&&(lstring[0].push(t),lstring[1].push(e))})})})}function setKeyZip(e){for(var t=0;t<e.length;t++){var o=e[t].split(" ");if(4==o.length){var n=parseInt(o[0])-1,s=(parseInt(o[1])-1)*keyY+(parseInt(o[2])-1),a=ablob[0].indexOf(o[3].replace(/\r/gi,""));a>-1&&(audio[n][s][keyCount[n][s]]=ablob[0][a],sound[n][s].push(new Audio(ablob[1][a])),keyCount[n][s]++)}}document.getElementById("KeySound").innerText="KeySound:Loaded"}function setLEDZip(e){for(var t=0;t<e[0].length;t++){var o=e[0][t].split(" "),n=e[1][t].split("\n"),s=parseInt(o[0])-1,a=(parseInt(o[1])-1)*keyX+(parseInt(o[2])-1);keyTest[s][a].push(n);var r=keyTest[s][a].length-1;for(ir=0;ir<parseInt(o[3])-1;ir++)keyTest[s][a][r]=keyTest[s][a][r].concat(n)}document.getElementById("LEDList").innerText="LEDList:Loaded"}function setProjectFile(){zip=new JSZip,stopT(),nowPage=0,LoadingStatus(),autoData.length=0,keyColor.length=0;for(var e=0;e<velocity.length;e++)velocity[e]=velocity[e].replace(/\./gi,","),keyColor[e]="rgba("+velocity[e]+opacity;for(var t=document.getElementById("zipUp"),o=0;o<t.files.length;o++)handleFile(t.files[o]);render()}function setNewPJ(){zip=new JSZip;var e=document.getElementById("pjName").value,t=document.getElementById("pjChain").value,o=document.getElementById("pjX").value,n=document.getElementById("pjY").value;autoData.length=0,sList.length=0,sInfo=[],chain=parseInt(t),keyX=parseInt(o),keyY=parseInt(n),sInfo.push("title="+e),sInfo.push("chain="+t),sInfo.push("ButtonX="+n),sInfo.push("ButtonY="+o),selinit(),arrinit(),setUpForm()}function setFile(){setKeyZip(sList),setLEDZip(lstring)}function getData(e,t){var o=JSON.stringify(e);jQuery.ajax({url:url,data:{msg:o},dataType:"jsonp",success:function(e){t(e)}})}function auto(){stopT(),autoP=!0,tt=0;for(var e=0;e<autoE.options.length;e++)if(autoE.options[e].selected){tt=e;break}autoProcess(tt)}function autoProcess(e){var t=0;if(e<autoData.length&&autoData.length>0&&autoP){var o=autoData[e].split(" "),n=o[0].toLowerCase();if("c"==n||"chain"==n)nowPage=parseInt(o[1])-1,render();else if("d"==n||"delay"==n)t+=parseInt(o[1]);else if("o"==n||"on"==n){var s=(parseInt(o[1])-1)*keyY+(parseInt(o[2])-1);keyTest[nowPage][s].length>0&&(choosedkey=s,keyLED1(nowPage,s,counter[nowPage][s],0)),playAudio(nowPage,s)}--t<0&&(t=0),t>=1?setTimeout(autoProcess,t,++e):autoProcess(++e)}else stopT()}function onLED(e,t){pressedKey[t]=1,coloredKey[t]=keyColor[120],(mobile||IE)&&requestAnimationFrame(function(){animatecanv(t)})}function onLED2(e,t,o){pressedKey[t]=1,parseInt(o)<keyColor.length?coloredKey[t]=keyColor[parseInt(o)]:coloredKey[t]=s2c(o),(mobile||IE)&&requestAnimationFrame(function(){animatecanv(t)})}function offLED(e,t){pressedKey[t]=0,(mobile||IE)&&requestAnimationFrame(function(){animatecanv(t)})}function keyLED1(e,t,o,n){var s=0,a=keyTest[e][t][o];if(void 0===a&&(o=0),a=keyTest[e][t][o][n],n<keyTest[e][t][o].length){var r=a.split(" "),c=r[0].toLowerCase();r.length>0&&("d"==c||"delay"==c?s+=parseInt(r[1]):"o"==c||"on"==c?"a"==r[3].toLowerCase()||"auto"==r[3].toLowerCase()?onLED2(e,(parseInt(r[1])-1)*keyY+(parseInt(r[2])-1),r[4]):onLED2(e,(parseInt(r[1])-1)*keyY+(parseInt(r[2])-1),r[3]):"f"!=c&&"off"!=c||offLED(e,(parseInt(r[1])-1)*keyY+(parseInt(r[2])-1))),--s<0&&(s=0),s>=1?st=setTimeout(keyLED1,s,e,t,o,n+1):keyLED1(e,t,o,n+1)}}function stopT(){choosedkey=null,clearTimeout(st),autoP=!1,initz(),render()}function s2c(e){for(var t=0,o=0;o<e.length;o++)t=e.charCodeAt(o)+((t<<5)-t);var n="#";for(o=0;o<3;o++){n+=("00"+(t>>8*o&255).toString(16)).substr(-2)}return n}function selinit(){autoE.options.length=0,keyE.options.length=0,ledE.options.length=0}function arrinit(){ablob.length=0,lstring.length=0,sList.length=0,lstring=[],(ablob=[])[0]=[],ablob[1]=[],lstring[0]=[],lstring[1]=[],sound.length=0,audio.length=0,pressedKey.length=0,coloredKey.length=0,keyCount.length=0,counter.length=0,keyTest.length=0,anim.length=0,drect.length=0,drect2.length=0,veldrects.length=0,dcir.length=0,rects.length=0,rects2.length=0,velrects.length=0,cirs.length=0,pageKeyColor.length=0,keyLEDList.length=0,upKeyList.length=0;for(var e=0;e<chain;e++){sound[e]=[],audio[e]=[],keyCount[e]=[],counter[e]=[],keyTest[e]=[],pageKeyColor[e]=[],keyLEDList[e]=[],upKeyList[e]=[];for(var t=0;t<keyX*keyY;t++)sound[e][t]=[],audio[e][t]=[],pressedKey[t]=0,coloredKey[t]="#FF0000",keyCount[e][t]=0,counter[e][t]=0,keyTest[e][t]=[],pageKeyColor[e][t]=strokeColor,keyLEDList[e][t]=[],upKeyList[e][t]=[]}}function initz(){pressedKey.fill(0),coloredKey.fill(strokeColor)}Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),o=t.length>>>0,n=arguments[1]>>0,s=n<0?Math.max(o+n,0):Math.min(n,o),a=arguments[2],r=void 0===a?o:a>>0,c=r<0?Math.max(o+r,0):Math.min(r,o);s<c;)t[s]=e,s++;return t}}),window.onload=function(){var e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t=(/constructor/i.test(window.HTMLElement)||(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString(),!!document.documentMode),o=!t&&!!window.StyleMedia;(!!window.chrome&&!!window.chrome.webstore||e)&&window.CSS;navigator.platform&&(0>"win16|win32|win64|mac".indexOf(navigator.platform.toLowerCase())?(mobile=!0,document.getElementById("Env").innerText="Mobile"):(mobile=!1,document.getElementById("Env").innerText="PC",t||o?(IE=!0,t&&alert("Audio almost not working well on IE...\nplease use other browser T^T\nSorry")):(IE=!1,createjs.Ticker.on("tick",render),createjs.Ticker.framerate=144))),mobile?alert("Mobile is not supported"):(canvas=document.getElementById("canv"),ctx=canvas.getContext("2d"),stage=new createjs.Stage("canv"),autoE=document.getElementById("autoEditor"),keyE=document.getElementById("keyEditor"),ledE=document.getElementById("ledEditor"),select=document.getElementById("Selector"),getData("./Songs",function(e){songs=e.msg;for(var t=0;t<songs.length;t++){var o=document.createElement("option");o.value=t,o.text=songs[t].split("\n")[0],select.add(o)}}),getData("./Velocity",function(e){velocity=e.msg,keyColor.length=0;for(var t=0;t<velocity.length;t++)velocity[t]=velocity[t].replace(/\./gi,","),keyColor[t]="rgba("+velocity[t]+opacity;arrinit(),cnv2Resize(),window.addEventListener("resize",function(){clearTimeout(timer),timer=setTimeout(cnv2Resize,300)},!1),document.getElementById("Velocity").innerText="Velocity:Loaded"}))};